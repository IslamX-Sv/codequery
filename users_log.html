<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - CodeQuery</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid #FFD700;
        }
        
        .header h1 {
            margin: 0;
            color: #FFD700;
        }
        
        .header p {
            margin: 10px 0 0 0;
            color: #aaa;
        }
        
        .users-list {
            background: #252525;
            border-radius: 5px;
            padding: 20px;
            min-height: 500px;
            font-size: 14px;
        }
        
        .user-item {
            background: #2d2d2d;
            border: 1px solid #333;
            border-radius: 3px;
            padding: 15px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .user-item:hover {
            background: #333;
        }
        
        .user-id {
            color: #569cd6;
            font-weight: bold;
        }
        
        .user-name {
            color: #dcdcaa;
            font-size: 16px;
            margin: 5px 0;
        }
        
        .user-email {
            color: #9cdcfe;
        }
        
        .user-password {
            color: #ce9178;
            font-family: monospace;
            background: #1e1e1e;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
        }
        
        .user-date {
            color: #6a9955;
            font-size: 12px;
        }
        
        .user-subscription {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .subscribed {
            background: #34a853;
            color: white;
        }
        
        .not-subscribed {
            background: #ea4335;
            color: white;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            background: #FFD700;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
        }
        
        button:hover {
            background: #ffed4d;
        }
        
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #aaa;
            margin-top: 10px;
        }
        
        .timestamp {
            color: #6a9955;
            font-size: 12px;
            text-align: center;
            margin-top: 20px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã –õ–æ–≥ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π CodeQuery</h1>
            <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
        </div>
        
        <div class="controls">
            <button onclick="refreshUsers()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            <button onclick="downloadTxt()">üì• –°–∫–∞—á–∞—Ç—å –∫–∞–∫ TXT</button>
            <button onclick="downloadJson()">üì• –°–∫–∞—á–∞—Ç—å –∫–∞–∫ JSON</button>
            <button onclick="clearAllUsers()" style="background: #ea4335; color: white;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ—Ö</button>
        </div>
        
        <div class="auto-refresh">
            <label>
                <input type="checkbox" id="autoRefresh" checked>
                –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
            </label>
        </div>
        
        <div class="users-list" id="usersList">
            <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∑–¥–µ—Å—å -->
        </div>
        
        <div class="timestamp" id="lastUpdate">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: --
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ localStorage
        function getUsers() {
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∞–π—Ç–∞
            try {
                // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –≤ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ
                const users = localStorage.getItem('codequery_users');
                if (users) {
                    return JSON.parse(users);
                }
            } catch (e) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ localStorage');
            }
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–∞
            try {
                const savedData = localStorage.getItem('codequery_users_backup');
                if (savedData) {
                    return JSON.parse(savedData);
                }
            } catch (e) {
                console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–∑ backup');
            }
            
            return [];
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function displayUsers() {
            const users = getUsers();
            const usersList = document.getElementById('usersList');
            
            if (users.length === 0) {
                usersList.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #888;">
                        <h3>üòï –ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–∞–π—Ç–µ</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="margin-bottom: 20px; color: #FFD700; font-size: 18px;">
                    –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${users.length}
                </div>
            `;
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            users.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            users.forEach((user, index) => {
                const regDate = new Date(user.createdAt);
                const formattedDate = regDate.toLocaleString('ru-RU');
                
                html += `
                    <div class="user-item">
                        <div class="user-id">#${user.id}</div>
                        <div class="user-name">üë§ ${user.name}</div>
                        <div class="user-email">üìß ${user.email}</div>
                        <div style="margin: 10px 0;">
                            <span class="user-password">üîë ${user.password}</span>
                        </div>
                        <div class="user-date">üìÖ ${formattedDate}</div>
                        <div class="user-subscription ${user.isSubscribed ? 'subscribed' : 'not-subscribed'}">
                            ${user.isSubscribed ? '‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞' : '‚ùå –ë–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏'}
                        </div>
                        <div style="margin-top: 10px; color: #aaa; font-size: 12px;">
                            –°–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${user.freeMessagesUsed || 0}/10
                        </div>
                    </div>
                `;
            });
            
            usersList.innerHTML = html;
            document.getElementById('lastUpdate').textContent = 
                `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date().toLocaleString('ru-RU')}`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
        function refreshUsers() {
            displayUsers();
            alert('–°–ø–∏—Å–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω!');
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–∞–∫ TXT
        function downloadTxt() {
            const users = getUsers();
            
            if (users.length === 0) {
                alert('–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                return;
            }
            
            let content = '=== –°–ü–ò–°–û–ö –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô COdeQuery ===\n\n';
            
            users.forEach((user, index) => {
                content += `–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ #${index + 1}\n`;
                content += `–ò–º—è: ${user.name}\n`;
                content += `Email: ${user.email}\n`;
                content += `–ü–∞—Ä–æ–ª—å: ${user.password}\n`;
                content += `–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${new Date(user.createdAt).toLocaleString('ru-RU')}\n`;
                content += `–ü–æ–¥–ø–∏—Å–∫–∞: ${user.isSubscribed ? '–î–∞' : '–ù–µ—Ç'}\n`;
                content += `–°–æ–æ–±—â–µ–Ω–∏–π: ${user.freeMessagesUsed || 0}/10\n`;
                content += '‚îÄ'.repeat(40) + '\n\n';
            });
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.href = url;
            link.download = `users_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
        }
        
        // –§—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–∞–∫ JSON
        function downloadJson() {
            const users = getUsers();
            
            if (users.length === 0) {
                alert('–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                return;
            }
            
            const data = {
                exportDate: new Date().toISOString(),
                total: users.length,
                users: users
            };
            
            const content = JSON.stringify(data, null, 2);
            const blob = new Blob([content], { type: 'application/json' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.href = url;
            link.download = `users_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function clearAllUsers() {
            if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                localStorage.removeItem('codequery_users');
                localStorage.removeItem('codequery_users_backup');
                alert('–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–¥–∞–ª–µ–Ω—ã!');
                displayUsers();
            }
        }
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        let autoRefreshInterval;
        
        function setupAutoRefresh() {
            const checkbox = document.getElementById('autoRefresh');
            
            function toggleRefresh() {
                if (checkbox.checked) {
                    autoRefreshInterval = setInterval(() => {
                        displayUsers();
                    }, 10000); // 10 —Å–µ–∫—É–Ω–¥
                } else {
                    clearInterval(autoRefreshInterval);
                }
            }
            
            checkbox.addEventListener('change', toggleRefresh);
            toggleRefresh();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            displayUsers();
            setupAutoRefresh();
            
            // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    displayUsers();
                }
            });
        });
    </script>
</body>
</html>